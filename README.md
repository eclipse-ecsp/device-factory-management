[<img src="./images/logo.png" width="300" height="150"/>](logo.png)

[![Build](../../actions/workflows/maven-build.yml/badge.svg)](../../actions/workflows/maven-build.yml)
[![License Compliance](../../actions/workflows/license-compliance.yml/badge.svg)](../../actions/workflows/license-compliance.yml)

# Device Factory Management

Device Factory Management Component provides multiple CRUD based restful services for registering and retrieving data
for the kinds of devices mentioned below:
Dongle HU TCU Dashcam

# Table of Contents

* [Getting Started](#getting-started)
* [Usage](#usage)
* [Architecture](#architecture)
* [How to contribute](#how-to-contribute)
* [Built with Dependencies](#built-with-dependencies)
* [Code of Conduct](#code-of-conduct)
* [Contributors](#contributors)
* [Security Contact Information](#security-contact-information)
* [Support](#support)
* [Troubleshooting](#troubleshooting)
* [License](#license)
* [Announcements](#announcements)
* [Acknowledgments](#acknowledgments)

## Getting Started

To build the project in the local working directory after the project has been cloned/forked, run:

```mvn clean install```

from the command line interface.

### Prerequisites

1. The list of tools required to build and run the project:
   JDK 17
   Apache Maven 3.8

Download and Install Apache Maven 3.8 locally and follow the below steps for IntelliJ IDE:

* Go to the right corner of the IDE and get inside the Maven option.
* Select the Maven Settings option and set the Maven Home Path to the path of the Apache Maven 3.8 installed locally.
* Click Apply and then OK.

2. Postgres DB needs to be installed and ignite database/schema should be created with the required tables.

* Link of the database and table scripts to be installed :
  [dmpostgres.sql](../../../csp-opensource-charts/blob/main/postgresql/db-scripts/dmpostgres.sql)

3. Add below secrets using secret.yaml:

```
{
  "hcp-deviceinfoquery-webapp": {
    "client_id": "device-mgmt",
    "client_secret": "*****",
    "swm_password": "ops-manual"
  }
}
```

* client_id and client_secret : fields used to connect with uidam server.
* swm_password : used to connect with swm server or redbend server.

### Installation

[How to set up Maven](https://maven.apache.org/install.html)

[Install Java](https://www.tutorials24x7.com/java/how-to-install-openjdk-17-on-windows)

### Coding style check configuration

[checkstyle.xml](./device-factory-management-api/checkstyle.xml) is the coding standard to follow while writing new/updating existing
code.

Checkstyle plugin [maven-checkstyle-plugin:3.2.1](https://maven.apache.org/plugins/maven-checkstyle-plugin/) is
integrated in [pom.xml](./pom.xml) which runs in the `validate` phase and `check` goal of the maven lifecycle and fails
the build if there are any checkstyle errors in the project.

There are a few coding guidelines to be followed manually before requesting for a pull request, the same can be found
here:

[Manual coding guidelines](Link to page with coding guidelines)

### Running the tests

To run the tests for this system run the below maven command.

```mvn test```

Or run a specific test

```mvn test -Dtest="TheFirstUnitTest"```

To run a method from within a test

```mvn test -Dtest="TheSecondUnitTest#whenTestCase2_thenPrintTest2_1"```

### Deployment

We can deploy this component as a Kubernetes pod by installing Device factory management charts.

Link:
[Charts](../../../csp-opensource-charts/tree/main/deviceinfoquery)

Detailed information about the request and response generated by
the [Device Factory Management APIs](Refer to API specifics of device-factory-management).

## Architecture

Sequence diagram of device creation:

[<img src="./images/dfmSequenceDiagram.png" width="800" height="300"/>](dfmSequenceDiagram.png)

## Usage

Device Factory Management microservice can be used to create devices, fetch device details, set/update device details and also delete the created devices from the database.
Devices are created and maintained in PostgreSQL DB with the Device attributes like imei, serialNumber, imsi,
deviceType, region etc

## Built With Dependencies

* [Spring](https://spring.io/projects/spring-framework) - The web framework used
* [Maven](https://maven.apache.org/) - Dependency Management
* [Postgres](https://jdbc.postgresql.org/) - Postgres JDBC driver
* [Project Lombok](https://projectlombok.org/) - Builder
* [Apache Common](https://commons.apache.org/proper/commons-lang/) - Java Library
* [Jackson](https://github.com/FasterXML) - Reading JSON Objects
* [MChange](https://www.mchange.com/projects/c3p0/) - JDBC3 Connection and Statement Pooling
* [Logback](https://logback.qos.ch/) - Log Functionality
* [slf4j](https://www.slf4j.org/) - Log Functionality
* [Mockito](https://site.mockito.org/) - Mocking Functionality
* [JUnit](https://junit.org/) - Testing Framework

## How to contribute

Please read [CONTRIBUTING.md](./CONTRIBUTING.md) for details on our contribution
guidelines, and the process for submitting pull requests to us.

## Code of Conduct

Please read [CODE_OF_CONDUCT.md](./CODE_OF_CONDUCT.md) for details on our code of conduct,
and the process for submitting pull requests to us.

## Contributors

The list of [contributors](../../graphs/contributors) who participated in this project.

## Security Contact Information

Please read [SECURITY.md](./SECURITY.md) to raise any security related issues.


## Support

Please write to us at [csp@harman.com](mailto:csp@harman.com)

## Troubleshooting

Please read [CONTRIBUTING.md](./CONTRIBUTING.md) for details on how to raise an issue and submit a pull request to us.

## License

This project is licensed under the Apache-2.0 License - see the [LICENSE](./LICENSE) file for details.

## Announcements

All updates to this component are present in our [releases page](../../releases).
For the versions available, see the [tags on this repository](../../tags).
